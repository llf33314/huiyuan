<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gt.member.dao.WxCardReceiveDAO">

	<!-- 通用查询映射结果 -->
	<resultMap id="BaseResultMap" type="com.gt.member.entity.WxCardReceive">
		<id column="id" property="id" />
		<result column="public_id" property="publicId" />
		<result column="username" property="username" />
		<result column="openid" property="openid" />
		<result column="friend_user_name" property="friendUserName" />
		<result column="ctime" property="ctime" />
		<result column="card_id" property="cardId" />
		<result column="is_give_by_friend" property="isGiveByFriend" />
		<result column="user_card_code" property="userCardCode" />
		<result column="old_user_card_code" property="oldUserCardCode" />
		<result column="outer_id" property="outerId" />
		<result column="status" property="status" />
	</resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, public_id , username, openid, friend_user_name ,
        ctime, card_id , is_give_by_friend, user_card_code , old_user_card_code , outer_id , status
    </sql>


	<select id="selectByCode" resultMap="BaseResultMap" >
		<!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Apr 28 09:51:54 CST 2016.
        -->
		select
		<include refid="Base_Column_List" />
		from t_wx_card_receive
		where user_card_code = #{code}
	</select>

	<select id="findByCardId" resultType="Map">
		SELECT    r.id, r.public_id, r.username, r.openid, r.friend_user_name, r.ctime, r.card_id, r.is_give_by_friend,
		r.user_card_code, r.old_user_card_code, r.outer_id, r.status,m.`nickname`,m.`phone`
		FROM t_wx_card_receive r  INNER JOIN t_wx_bus_member m ON m.`openid`=r.`openid`
		where r.card_id=#{cardId} and r.status!=1
		ORDER BY r.id DESC limit #{firstResult},#{pageSize}
	</select>

	<select id="findByCardIdCount" resultType="java.lang.Integer">
		select  count(id)
		from t_wx_card_receive where card_id=#{cardId} and status!=1
	</select>

	<select id="findByOpenId" resultType="Map">
		select r.id, r.public_id, r.username, r.openid, r.friend_user_name, r.ctime, r.card_id, r.is_give_by_friend,
		r.user_card_code, r.old_user_card_code, r.outer_id, r.status,
		c.code_type,c.deal_detail,c.cash_least_cost,c.reduce_cost,c.discount,c.gift,c.default_detail,c.begin_timestamp,c.end_timestamp,c.custom_url,
		c.fixed_term,c.fixed_begin_term,c.image,c.card_type,c.type FROM t_wx_card_receive r INNER JOIN t_wx_card c ON r.`card_id`=c.card_id where r.public_id=#{publicId} and r.openid=#{openid}
	</select>


	<select id="findByOpenId1" resultType="Map">
		select r.id, r.public_id, r.username, r.openid, r.friend_user_name, r.ctime, r.card_id, r.is_give_by_friend,
		r.user_card_code, r.old_user_card_code, r.outer_id, r.status,c.title,
		c.code_type,c.deal_detail,c.cash_least_cost,c.reduce_cost,c.discount,c.gift,c.default_detail,c.begin_timestamp,c.end_timestamp,c.custom_url,
		c.fixed_term,c.fixed_begin_term,c.image,c.card_type,c.type,c.location_id_list,c.time_limit FROM t_wx_card_receive r INNER JOIN t_wx_card c ON r.`card_id`=c.card_id
		where r.public_id=#{publicId} and r.openid=#{openid} and r.status=0 group by r.card_id
	</select>

	<select id="findByCode" resultMap="BaseResultMap">
		SELECT  r.id, r.public_id, username, openid, friend_user_name, r.ctime, r.card_id, is_give_by_friend,
		user_card_code, old_user_card_code, outer_id, STATUS FROM t_wx_card_receive r INNER JOIN t_wx_card c ON r.`card_id`=c.card_id
		where r.public_id=#{publicId} and r.user_card_code=#{code,jdbcType=VARCHAR} and r.status=0  limit 1
	</select>

	<select id="findByCode1" resultMap="BaseResultMap">
		select <include refid="Base_Column_List" />
		from t_wx_card_receive
		where public_id = #{publicId} and user_card_code= #{code,jdbcType=VARCHAR} and status=0 limit 1
	</select>

	<select id="findByCodeAndPublicId" resultType="Map">
		select <include refid="Base_Column_List" />
		from t_wx_card_receive
		where user_card_code= #{cardcode,jdbcType=VARCHAR} limit 1
	</select>


	<select id="countReceive" resultType="java.lang.Integer">
		select count(id) from t_wx_card_receive where status=0 and openid=#{openId}
	</select>
</mapper>
