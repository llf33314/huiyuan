<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gt.member.dao.UserConsumeNewDAO">

	<!-- 通用查询映射结果 -->
	<resultMap id="BaseResultMap" type="com.gt.member.entity.UserConsumeNew">
		<id column="id" property="id" />
		<result column="busId" property="busId" />
		<result column="memberId" property="memberId" />
		<result column="mcId" property="mcId" />
		<result column="ctId" property="ctId" />
		<result column="gtId" property="gtId" />
		<result column="recordType" property="recordType" />
		<result column="ucType" property="ucType" />
		<result column="totalMoney" property="totalMoney" />
		<result column="integral" property="integral" />
		<result column="fenbi" property="fenbi" />
		<result column="uccount" property="uccount" />
		<result column="discountMoney" property="discountMoney" />
		<result column="discountAfterMoney" property="discountAfterMoney" />
		<result column="changeFlow" property="changeFlow" />
		<result column="dvId" property="dvId" />
		<result column="disCountdepict" property="disCountdepict" />
		<result column="cardType" property="cardType" />
		<result column="balance" property="balance" />
		<result column="flowState" property="flowState" />
		<result column="dataSource" property="dataSource" />
		<result column="isend" property="isend" />
		<result column="ischongzhi" property="ischongzhi" />
		<result column="isendDate" property="isendDate" />
		<result column="orderCode" property="orderCode" />
		<result column="shopId" property="shopId" />
		<result column="createDate" property="createDate" />
		<result column="payStatus" property="payStatus" />
		<result column="flowbalance" property="flowbalance" />
		<result column="balanceCount" property="balanceCount" />
		<result column="refundMoney" property="refundMoney" />
		<result column="refundFenbi" property="refundFenbi" />
		<result column="refundJifen" property="refundJifen" />
		<result column="refundDate" property="refundDate" />
		<result column="fukaCtId" property="fukaCtId" />
	</resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">

       id, busId AS busId, memberId AS memberId, mcId AS mcId, ctId AS ctId, gtId AS gtId, recordType AS recordType, ucType AS ucType, totalMoney AS totalMoney, integral, fenbi, uccount, discountMoney AS discountMoney, discountAfterMoney AS discountAfterMoney,
		changeFlow AS changeFlow, dvId AS dvId, disCountdepict AS disCountdepict, cardType AS cardType, balance, flowState AS flowState, dataSource AS dataSource, isend, ischongzhi,
		isendDate AS isendDate, orderCode AS orderCode, shopId AS shopId, createDate AS createDate, payStatus AS payStatus, balanceCount AS balanceCount, refundMoney AS refundMoney,
		refundFenbi AS refundFenbi, refundJifen AS refundJifen, refundDate AS refundDate,flowbalance,fukaCtId

	</sql>


	<select id="findByCode" resultMap="BaseResultMap">
		select * from t_wx_user_consume_new where busId=#{busId} and orderCode=#{orderCode}

	</select>

	<select id="countOrder" resultType="java.lang.Integer">
		select count(id) from t_wx_user_consume_new where ctId=#{ctId} and busId=#{busId} and payStatus=1
	</select>

	<select id="sumXiaofei" resultType="java.lang.Double">
		select sum(discountAfterMoney) from t_wx_user_consume_new where 	recordType=2 and ctId=#{ctId} and busId=#{busId} and payStatus=1
	</select>

	<select id="buyCard" resultType="java.lang.Double">
		select sum(discountAfterMoney) from t_wx_user_consume_new where ucType=13 and ctId=#{ctId} and payStatus=1
	</select>


	<select id="sum7DayOrder" resultType="Map">
		SELECT DATE_FORMAT(createDate, '%Y-%m-%d') AS time, SUM(discountAfterMoney) AS discountAfterMoney FROM t_wx_user_consume_new
		where recordType=2 and ctId=#{ctId} and busId=#{busId} and payStatus=1 and createDate <![CDATA[<=]]>#{date}
		GROUP BY DATE_FORMAT(createDate, '%Y-%m-%d')
		ORDER BY time DESC  LIMIT 7
	</select>


	<select id="sum7DayBuyCard" resultType="Map">
		SELECT DATE_FORMAT(createDate, '%Y-%m-%d') AS buytime1, SUM(discountAfterMoney) AS buyDiscountAfterMoney FROM t_wx_user_consume_new
		where
		ucType=13 and ctId=#{ctId} and busId=#{busId} and payStatus=1 and createDate <![CDATA[<=]]>#{date}
		GROUP BY DATE_FORMAT(createDate, '%Y-%m-%d')
		ORDER BY buytime1 DESC  LIMIT 7
	</select>


	<select id="countJifenDuiHan" resultType="Map">
		SELECT DATE_FORMAT(createDate, '%Y-%m-%d') AS createDate, SUM(integral) as integralCount FROM t_wx_user_consume_new WHERE  busId=#{busId} and  ctId=1   GROUP BY DATE_FORMAT(createDate, '%Y-%m-%d')
		ORDER BY a1 DESC  LIMIT 7
	</select>


	<select id="countUseJifen" resultType="java.lang.Integer">
		SELECT SUM(integral) FROM t_wx_user_consume_new  WHERE  ctId=1 and busId=#{busId} and payStatus=1
	</select>


	<select id="sum7DayDiscount" resultType="Map">
		SELECT DATE_FORMAT(createDate, '%Y-%m-%d') as createDate,SUM(discountMoney) AS discountMoney FROM t_wx_user_consume_new
		WHERE recordType=2 and  ctId=2 AND busId=#{busId} AND payStatus=1
		GROUP BY DATE_FORMAT(createDate, '%Y-%m-%d')
		ORDER BY createDate DESC   LIMIT 7
	</select>


	<select id="sumDisCount" resultType="java.lang.Double">
		SELECT SUM(discountMoney)  FROM t_wx_user_consume_new
		WHERE recordType=2  AND ctId=2 AND busId=#{busId} AND payStatus=1
	</select>

	<select id="sumChongzhi" resultType="java.lang.Double">
		select sum(discountAfterMoney) as discountAfterMoney from t_wx_user_consume_new where recordType=1 and busId=#{busId} and ctId=3 AND payStatus=1
	</select>



	<select id="sumChongzhi7Day" resultType="Map">
		SELECT DATE_FORMAT(createDate, '%Y-%m-%d') AS createDate ,SUM(discountAfterMoney) AS discountAfterMoney FROM t_wx_user_consume_new WHERE  recordType=1  AND busId=#{busId} AND ctId=3 AND payStatus=1
		GROUP BY DATE_FORMAT(createDate, '%Y-%m-%d')
		ORDER BY createDate DESC
		LIMIT 7
	</select>


	<select id="sumCiKa" resultType="Map">
		SELECT DATE_FORMAT(createDate, '%Y-%m-%d') AS createDate,SUM(uccount) AS uccount FROM t_wx_user_consume_new WHERE  recordType=2 AND busId=#{busId} AND ctId=5 AND payStatus=1
		GROUP BY DATE_FORMAT(createDate, '%Y-%m-%d')
		ORDER BY createDate DESC
		LIMIT 7
	</select>


	<select id="userCiKa" resultType="java.lang.Integer">
		SELECT SUM(uccount) FROM t_wx_user_consume_new WHERE recordType=2 AND busId=#{busId} AND payStatus=1
	</select>




	<select id="countOrder" resultType="java.lang.Integer">
		select count(id) from t_wx_user_consume_new where ctId=#{ctId} and busId=#{busId} and payStatus=1
	</select>

	<select id="sumXiaofei" resultType="java.lang.Double">
		select sum(discountAfterMoney) from t_wx_user_consume_new
		where 	recordType=2 and ctId=#{ctId} and busId=#{busId} and payStatus=1
	</select>

	<select id="buyCard" resultType="java.lang.Double">
		select sum(discountAfterMoney) from t_wx_user_consume_new where ucType=13 and ctId=#{ctId} and payStatus=1
	</select>


	<select id="sum7DayOrder" resultType="Map">
		SELECT DATE_FORMAT(createDate, '%Y-%m-%d') AS time, SUM(discountAfterMoney) AS discountAfterMoney FROM t_wx_user_consume_new
		where recordType=2
		<if test="ctId>0">
			and ctId=#{ctId}
		</if>
		and busId=#{busId}
		and payStatus=1
		<if test="startDate!=null">
			and createDate <![CDATA[>=]]>#{startDate}
		</if>
		<if test="endDate!=null">
			and createDate <![CDATA[<=]]>#{endDate}
		</if>
		GROUP BY DATE_FORMAT(createDate, '%Y-%m-%d')
		ORDER BY time DESC  LIMIT 7
	</select>


	<select id="sum7DayBuyCard" resultType="Map">
		SELECT DATE_FORMAT(createDate, '%Y-%m-%d') AS buytime1, SUM(discountAfterMoney) AS buyDiscountAfterMoney FROM t_wx_user_consume_new
		where
		ucType=13 and ctId=#{ctId} and busId=#{busId} and payStatus=1
		<if test="startDate!=null">
			and createDate <![CDATA[>=]]>#{startDate}
		</if>
		<if test="endDate!=null">
			and createDate <![CDATA[<=]]>#{endDate}
		</if>
		GROUP BY DATE_FORMAT(createDate, '%Y-%m-%d')
		ORDER BY buytime1 DESC  LIMIT 7
	</select>



	<select id="countJifenDuiHan" resultType="Map">
		SELECT DATE_FORMAT(createDate, '%Y-%m-%d') AS createDate, SUM(integral) as integralCount FROM t_wx_user_consume_new WHERE  busId=#{busId} and  ctId=1   GROUP BY DATE_FORMAT(createDate, '%Y-%m-%d')
		ORDER BY createDate DESC  LIMIT 7
	</select>


	<select id="countUseJifen" resultType="java.lang.Integer">
		SELECT SUM(integral) FROM t_wx_user_consume_new  WHERE  ctId=1 and busId=#{busId} and payStatus=1
	</select>


	<select id="sum7DayDiscount" resultType="Map">
		SELECT DATE_FORMAT(createDate, '%Y-%m-%d') as createDate,SUM(discountMoney) AS discountMoney FROM t_wx_user_consume_new
		WHERE recordType=2 and  ctId=2 AND busId=#{busId} AND payStatus=1
		GROUP BY DATE_FORMAT(createDate, '%Y-%m-%d')
		ORDER BY createDate DESC   LIMIT 7
	</select>


	<select id="sumDisCount" resultType="java.lang.Double">
		SELECT SUM(discountMoney)  FROM t_wx_user_consume_new
		WHERE recordType=2  AND ctId=2 AND busId=#{busId} AND payStatus=1
	</select>

	<select id="sumChongzhi" resultType="java.lang.Double">
		select sum(discountAfterMoney) as discountAfterMoney from t_wx_user_consume_new where recordType=1 and busId=#{busId} and ctId=3 AND payStatus=1
	</select>



	<select id="sumChongzhi7Day" resultType="Map">
		SELECT DATE_FORMAT(createDate, '%Y-%m-%d') AS createDate ,SUM(discountAfterMoney) AS discountAfterMoney
		FROM t_wx_user_consume_new WHERE  recordType=1  AND busId=#{busId} AND ctId=3 AND payStatus=1
		GROUP BY DATE_FORMAT(createDate, '%Y-%m-%d')
		ORDER BY createDate DESC
		LIMIT 7
	</select>


	<select id="sumCiKa" resultType="Map">
		SELECT DATE_FORMAT(createDate, '%Y-%m-%d') AS createDate,SUM(uccount) AS uccount FROM t_wx_user_consume_new WHERE  recordType=2 AND busId=#{busId} AND ctId=5 AND payStatus=1
		GROUP BY DATE_FORMAT(createDate, '%Y-%m-%d')
		ORDER BY createDate DESC
		LIMIT 7
	</select>


	<select id="userCiKa" resultType="java.lang.Integer">
		SELECT SUM(uccount) FROM t_wx_user_consume_new WHERE recordType=2 AND busId=#{busId} AND payStatus=1
	</select>




	<select id="findOneByCode" resultMap="BaseResultMap">
		select * from t_wx_user_consume_new where orderCode=#{orderCode}
	</select>

	<select id="findUserConsumeChongZhiByMohe" resultType="Map">
		select * from t_wx_user_consume_new where busId=#{busId} and recordType=1 and payStatus=1
		<if test="memberId!=null">
			and memberId=#{memberId}
		</if>
		<if test="shopId>0">
			and shopId=#{shopId}
		</if>

		<if test="startDate!=null">
			and createDate <![CDATA[>=]]> #{startDate}
		</if>

		<if test="endDate!=null">
			and createDate <![CDATA[<=]]> #{endDate}
		</if>
		ORDER BY id DESC limit #{first},#{pageSize}


	</select>


	<select id="findUserConsumeChongZhiByMemberId" resultType="Map">
		select * from t_wx_user_consume_new where busId=#{busId} and recordType=1
		<if test="memberId!=null">
			and memberId=#{memberId}
		</if>
		<if test="startDate!=null">
			and createDate <![CDATA[>=]]> #{startDate}
		</if>

		<if test="endDate!=null">
			and createDate <![CDATA[<=]]> #{endDate}
		</if>
		ORDER BY id DESC limit #{first},#{pageSize}
	</select>




	<select id="countUserConsumeChongZhiByMemberId" resultType="java.lang.Integer">
		select count(id) from t_wx_user_consume_new where busId=#{busId} and recordType=2
		<if test="memberId!=null">
			and memberId=#{memberId}
		</if>
		<if test="startDate!=null">
			and createDate <![CDATA[>=]]> #{startDate}
		</if>

		<if test="endDate!=null">
			and createDate <![CDATA[<=]]> #{endDate}
		</if>
	</select>

	<select id="findUserConsumeDuiHuanByMemberId" resultType="Map">
		select * from t_wx_user_consume_new where busId=#{busId} and recordType=2
		<if test="memberId!=null">
			and memberId=#{memberId}
		</if>
		<if test="startDate!=null">
			and createDate <![CDATA[>=]]> #{startDate}
		</if>

		<if test="endDate!=null">
			and createDate <![CDATA[<=]]> #{endDate}
		</if>
		ORDER BY id DESC limit #{first},#{pageSize}
	</select>


	<select id="countUserConsumeDuiHuanByMemberId" resultType="java.lang.Integer">
		select count(id) from t_wx_user_consume_new where busId=#{busId} and recordType=2
		<if test="memberId!=null">
			and memberId=#{memberId}
		</if>
		<if test="startDate!=null">
			and createDate <![CDATA[>=]]> #{startDate}
		</if>

		<if test="endDate!=null">
			and createDate <![CDATA[<=]]> #{endDate}
		</if>
	</select>



	<select id="countUserConsumeCikaByMemberId" resultType="java.lang.Integer">
		select count(id) from t_wx_user_consume_new where busId=#{busId} and recordType=3
		<if test="memberId!=null">
			and memberId=#{memberId}
		</if>
		<if test="startDate!=null">
			and createDate <![CDATA[>=]]> #{startDate}
		</if>

		<if test="endDate!=null">
			and createDate <![CDATA[<=]]> #{endDate}
		</if>
	</select>


	<select id="findUserConsumeCikaByMemberId" resultType="Map">
		select * from t_wx_user_consume_new where busId=#{busId} and recordType=3
		<if test="memberId!=null">
			and memberId=#{memberId}
		</if>
		<if test="startDate!=null">
			and createDate <![CDATA[>=]]> #{startDate}
		</if>

		<if test="endDate!=null">
			and createDate <![CDATA[<=]]> #{endDate}
		</if>
		ORDER BY id DESC limit #{first},#{pageSize}
	</select>


	<select id="countUserConsumeXiaoFeiByMemberId" resultType="java.lang.Integer">
		select count(id) from t_wx_user_consume_new where busId=#{busId} and recordType=2
		<if test="memberId!=null">
			and memberId=#{memberId}
		</if>
		<if test="payStatus!=null">
			and payStatus=#{payStatus}
		</if>
		<if test="startDate!=null">
			and createDate <![CDATA[>=]]> #{startDate}
		</if>

		<if test="endDate!=null">
			and createDate <![CDATA[<=]]> #{endDate}
		</if>
	</select>


	<select id="findUserConsumeXiaoFeiByMemberId" resultType="Map">
		select * from t_wx_user_consume_new where busId=#{busId} and recordType=2
		<if test="memberId!=null">
			and memberId=#{memberId}
		</if>
		<if test="payStatus!=null">
			and payStatus=#{payStatus}
		</if>
		<if test="startDate!=null">
			and createDate <![CDATA[>=]]> #{startDate}
		</if>

		<if test="endDate!=null">
			and createDate <![CDATA[<=]]> #{endDate}
		</if>
		ORDER BY id DESC limit #{first},#{pageSize}
	</select>





</mapper>
